"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ScrollObserver = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _helpers = require("./helpers");

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var nameSpace = 'ScrollObserver';

var state = function state(visible, alreadyFired) {
  this.visible = false;
  this.alreadyFired = false;
};

var setClassName = function setClassName(options) {
  var toggle = _objectSpread({
    element: null,
    className: null
  }, options);

  if (!toggle.element) {
    (0, _helpers.errorLog)(nameSpace, "Be sure to set a const toggleElement = (reactRef.current or document.querySelector) in the new ".concat(nameSpace, "({ toggle: { element: toggleElement } })"));
  }

  if (!toggle.className) {
    (0, _helpers.errorLog)(nameSpace, "Be sure to set the className you want to toggle in the new ".concat(nameSpace, "({ toggle: { className: \"my-class\" } })"));
  }

  this.add = function () {
    !toggle.element.classList.contains(toggle.className) && toggle.element.classList.add(toggle.className);
  };

  this.remove = function () {
    toggle.element.classList.contains(toggle.className) && toggle.element.classList.remove(toggle.className);
  };

  this.update = function (setState) {
    if (!setState.alreadyFired && setState.visible) {
      this.add();
      setState.alreadyFired = true;
    }

    if (setState.alreadyFired && !setState.visible) {
      this.remove();
      setState.alreadyFired = false;
    }
  };
};

var setTween = function setTween(options) {
  var gsap = _objectSpread({
    timeline: null,
    yoyo: false,
    speed: 1,
    reverseSpeed: 1,
    delay: 2
  }, options);

  if (!gsap.timeline) {
    (0, _helpers.errorLog)(nameSpace, "Be sure to set a const tl = gsap.timeline({ paused: true }) in the new ".concat(nameSpace, "({ gsap: { timeline: tl } })"));
  }

  var tl = gsap.timeline;

  if (gsap.yoyo) {
    tl.repeat(-1).yoyo(gsap.yoyo).repeatDelay(gsap.delay);
  }

  this.play = function () {
    tl.timeScale(gsap.speed).play();
  };

  this.pause = function () {
    tl.pause();
  };

  this.reverse = function () {
    tl.timeScale(gsap.reverseSpeed).reverse();
  };

  this.kill = function () {
    if (tl) {
      tl.pause(0);
      tl.kill();
    }
  };

  this.update = function (setState) {
    if (!setState.alreadyFired && setState.visible) {
      this.play();
      setState.alreadyFired = true;
    }

    if (setState.alreadyFired && !setState.visible) {
      gsap.yoyo ? this.pause() : this.reverse();
      setState.alreadyFired = false;
    }
  };

  this.scrub = function (intersectionRatio) {
    tl.progress(intersectionRatio);
  };
};

var setPlayer = function setPlayer(options) {
  var video = _objectSpread({
    element: null
  }, options);

  if (!video.element) {
    (0, _helpers.errorLog)(nameSpace, "Be sure to set a video element in the new ".concat(nameSpace, "({ video: { element: videoRef.current } })"));
  }

  this.play = function () {
    video.element.play();
  };

  this.pause = function () {
    video.element.pause();
  };

  this.kill = function () {
    video.element.pause();
  };

  this.update = function (setState) {
    if (!setState.alreadyFired && setState.visible) {
      this.play();
      setState.alreadyFired = true;
    }

    if (setState.alreadyFired && !setState.visible) {
      this.pause();
      setState.alreadyFired = false;
    }
  };
};

var setFunction = function setFunction(options) {
  var callback = _objectSpread({
    active: null,
    notActive: null
  }, options);

  if (!callback.active && !callback.notActive) {
    (0, _helpers.errorLog)(nameSpace, "Be sure to set a callback active or notActive function in the new ".concat(nameSpace, "({ callback: { active: () => () } })"));
  }

  if (callback.active && !(0, _helpers.isFunc)(callback.active) || callback.notActive && !(0, _helpers.isFunc)(callback.notActive)) {
    (0, _helpers.errorLog)(nameSpace, "Be sure to set the callback as a function ");
  }

  this.update = function (setState) {
    if (!setState.alreadyFired && setState.visible && callback.active) {
      callback.active();
      setState.alreadyFired = true;
    }

    if (setState.alreadyFired && !setState.visible && callback.active) {
      callback.notActive();
      setState.alreadyFired = false;
    }
  };
};

var ScrollObserver = function ScrollObserver(_ref) {
  var breakpoints = _ref.breakpoints,
      callback = _ref.callback,
      destroyImmediately = _ref.destroyImmediately,
      gsap = _ref.gsap,
      observer = _ref.observer,
      offset = _ref.offset,
      whenVisible = _ref.whenVisible,
      thresholds = _ref.thresholds,
      toggle = _ref.toggle,
      triggerElement = _ref.triggerElement,
      useDuration = _ref.useDuration,
      video = _ref.video;

  if (!triggerElement) {
    (0, _helpers.errorLog)(nameSpace, 'Be sure to set a const triggerElement = (reactRef.current or document.querySelector) in the new ScrollScene({ triggerElement: triggerElement })');
  }

  var $this = this;
  var setToggle;
  var setGsap;
  var setVideo;
  var setCallback;
  var ratio;
  var setRootMargin = '0% 0%';
  var setState = new state(false, false);

  if (typeof offset === 'number') {
    setRootMargin = "-".concat(Math.abs(offset), "px 0%");
  } else if (typeof offset === 'string') {
    setRootMargin = "-".concat(Math.abs(parseFloat(offset)), "% 0%");
  }

  if (toggle && (0, _helpers.isObject)(toggle)) {
    setToggle = new setClassName(toggle);
  }

  if (gsap && (0, _helpers.isObject)(gsap)) {
    setGsap = new setTween(gsap);
  }

  if (video && (0, _helpers.isObject)(video)) {
    setVideo = new setPlayer(video);
  }

  if (callback) {
    setCallback = new setFunction(callback);
  }

  var observerCallback = function observerCallback(entries) {
    entries.forEach(function (_ref2) {
      var isIntersecting = _ref2.isIntersecting,
          intersectionRatio = _ref2.intersectionRatio;

      if (ratio) {
        setState.visible = intersectionRatio >= ratio;
      } else if (isIntersecting && !setState.visible) {
        setState.visible = true;
      } else if (!isIntersecting && setState.visible) {
        setState.visible = false;
      }

      setToggle && setToggle.update(setState);
      setGsap && (!useDuration ? setGsap.update(setState) : setGsap.scrub(intersectionRatio));
      setVideo && setVideo.update(setState);
      setCallback && setCallback.update(setState);

      if (isIntersecting && destroyImmediately) {
        $this.destroy();
      }
    });
  };

  var getPercentage = function getPercentage(value) {
    if (!(0, _helpers.isString)(whenVisible) && !(0, _helpers.stringContains)(whenVisible, '%')) {
      (0, _helpers.errorLog)(nameSpace, 'Be sure to set a percentage as a string. { whenVisible: "50%" }');
    }

    var parsed = parseInt(value.replace('%', '')) / 100;
    ratio = parsed;
    return parsed;
  };

  var getThresolds = function getThresolds() {
    var defaults = {
      one: [0, 1],
      gsap: (0, _helpers.createArray)(199)
    };
    var returnedThresholds = defaults.one;

    if (whenVisible) {
      returnedThresholds = getPercentage(whenVisible);
    }

    if (useDuration) {
      returnedThresholds = defaults.gsap;
    }

    if (thresholds) {
      returnedThresholds = (0, _helpers.createArray)(thresholds);
    }

    return returnedThresholds;
  };

  var Observer = new IntersectionObserver(observerCallback, _objectSpread({
    threshold: getThresolds(),
    rootMargin: setRootMargin
  }, observer));

  this.init = function () {
    Observer.observe(triggerElement);
  };

  this.destroy = function () {
    if (triggerElement && Observer) {
      if (setToggle) {
        setToggle.remove();
      }

      if (setGsap) {
        setGsap.kill();
      }

      if (setVideo) {
        setVideo.kill();
      }

      Observer.unobserve(triggerElement);
    }
  };

  (0, _helpers.scrollAnimationInit)(breakpoints, this.init, this.destroy);
};

exports.ScrollObserver = ScrollObserver;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9TY3JvbGxPYnNlcnZlci50cyJdLCJuYW1lcyI6WyJuYW1lU3BhY2UiLCJzdGF0ZSIsInZpc2libGUiLCJhbHJlYWR5RmlyZWQiLCJzZXRDbGFzc05hbWUiLCJvcHRpb25zIiwidG9nZ2xlIiwiZWxlbWVudCIsImNsYXNzTmFtZSIsImFkZCIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwicmVtb3ZlIiwidXBkYXRlIiwic2V0U3RhdGUiLCJzZXRUd2VlbiIsImdzYXAiLCJ0aW1lbGluZSIsInlveW8iLCJzcGVlZCIsInJldmVyc2VTcGVlZCIsImRlbGF5IiwidGwiLCJyZXBlYXQiLCJyZXBlYXREZWxheSIsInBsYXkiLCJ0aW1lU2NhbGUiLCJwYXVzZSIsInJldmVyc2UiLCJraWxsIiwic2NydWIiLCJpbnRlcnNlY3Rpb25SYXRpbyIsInByb2dyZXNzIiwic2V0UGxheWVyIiwidmlkZW8iLCJzZXRGdW5jdGlvbiIsImNhbGxiYWNrIiwiYWN0aXZlIiwibm90QWN0aXZlIiwiU2Nyb2xsT2JzZXJ2ZXIiLCJicmVha3BvaW50cyIsImRlc3Ryb3lJbW1lZGlhdGVseSIsIm9ic2VydmVyIiwib2Zmc2V0Iiwid2hlblZpc2libGUiLCJ0aHJlc2hvbGRzIiwidHJpZ2dlckVsZW1lbnQiLCJ1c2VEdXJhdGlvbiIsIiR0aGlzIiwic2V0VG9nZ2xlIiwic2V0R3NhcCIsInNldFZpZGVvIiwic2V0Q2FsbGJhY2siLCJyYXRpbyIsInNldFJvb3RNYXJnaW4iLCJNYXRoIiwiYWJzIiwicGFyc2VGbG9hdCIsIm9ic2VydmVyQ2FsbGJhY2siLCJlbnRyaWVzIiwiZm9yRWFjaCIsImlzSW50ZXJzZWN0aW5nIiwiZGVzdHJveSIsImdldFBlcmNlbnRhZ2UiLCJ2YWx1ZSIsInBhcnNlZCIsInBhcnNlSW50IiwicmVwbGFjZSIsImdldFRocmVzb2xkcyIsImRlZmF1bHRzIiwib25lIiwicmV0dXJuZWRUaHJlc2hvbGRzIiwiT2JzZXJ2ZXIiLCJJbnRlcnNlY3Rpb25P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LGNBQWpCO0FBQ0QsR0FGRDs7QUFJQSxPQUFLZ0IsT0FBTCxHQUFlLFlBQVc7QUFDeEIsUUFBSWhCLGNBQWMsSUFBSTBCLFFBQXRCLEVBQWdDO0FBQzlCLFVBQUl2QixTQUFKLEVBQWU7QUFDYkEsUUFBQUEsU0FBUyxDQUFDckMsTUFBVjtBQUNEOztBQUVELFVBQUlzQyxPQUFKLEVBQWE7QUFDWEEsUUFBQUEsT0FBTyxDQUFDckIsSUFBUjtBQUNEOztBQUVELFVBQUlzQixRQUFKLEVBQWM7QUFDWkEsUUFBQUEsUUFBUSxDQUFDdEIsSUFBVDtBQUNEOztBQUVEMkMsTUFBQUEsUUFBUSxDQUFDTSxTQUFULENBQW1CaEMsY0FBbkI7QUFDRDtBQUNGLEdBaEJEOztBQWtCQSxvQ0FBb0JOLFdBQXBCLEVBQWlDLEtBQUtvQyxJQUF0QyxFQUE0QyxLQUFLZCxPQUFqRDtBQUNELENBeEpEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXJyb3JMb2csIGlzRnVuYywgaXNPYmplY3QsIHNjcm9sbEFuaW1hdGlvbkluaXQsIGNyZWF0ZUFycmF5LCBpc1N0cmluZywgc3RyaW5nQ29udGFpbnMgfSBmcm9tICcuL2hlbHBlcnMnXG5cbmNvbnN0IG5hbWVTcGFjZSA9ICdTY3JvbGxPYnNlcnZlcidcblxuLy8gQHRzLWlnbm9yZVxuY29uc3Qgc3RhdGUgPSBmdW5jdGlvbih2aXNpYmxlLCBhbHJlYWR5RmlyZWQpIHtcbiAgdGhpcy52aXNpYmxlID0gZmFsc2VcbiAgdGhpcy5hbHJlYWR5RmlyZWQgPSBmYWxzZVxufVxuXG5jb25zdCBzZXRDbGFzc05hbWUgPSBmdW5jdGlvbih0aGlzOiBhbnksIG9wdGlvbnMpIHtcbiAgY29uc3QgdG9nZ2xlID0ge1xuICAgIGVsZW1lbnQ6IG51bGwsXG4gICAgY2xhc3NOYW1lOiBudWxsLFxuICAgIC4uLm9wdGlvbnMsXG4gIH1cblxuICBpZiAoIXRvZ2dsZS5lbGVtZW50KSB7XG4gICAgZXJyb3JMb2coXG4gICAgICBuYW1lU3BhY2UsXG4gICAgICBgQmUgc3VyZSB0byBzZXQgYSBjb25zdCB0b2dnbGVFbGVtZW50ID0gKHJlYWN0UmVmLmN1cnJlbnQgb3IgZG9jdW1lbnQucXVlcnlTZWxlY3RvcikgaW4gdGhlIG5ldyAke25hbWVTcGFjZX0oeyB0b2dnbGU6IHsgZWxlbWVudDogdG9nZ2xlRWxlbWVudCB9IH0pYCxcbiAgICApXG4gIH1cblxuICBpZiAoIXRvZ2dsZS5jbGFzc05hbWUpIHtcbiAgICBlcnJvckxvZyhcbiAgICAgIG5hbWVTcGFjZSxcbiAgICAgIGBCZSBzdXJlIHRvIHNldCB0aGUgY2xhc3NOYW1lIHlvdSB3YW50IHRvIHRvZ2dsZSBpbiB0aGUgbmV3ICR7bmFtZVNwYWNlfSh7IHRvZ2dsZTogeyBjbGFzc05hbWU6IFwibXktY2xhc3NcIiB9IH0pYCxcbiAgICApXG4gIH1cblxuICB0aGlzLmFkZCA9IGZ1bmN0aW9uKCkge1xuICAgIC8qIGFkZCBjbGFzc05hbWUgaWYgaXQncyBub3QgYWxyZWFkeSB0aGVyZSAqL1xuICAgICF0b2dnbGUuZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnModG9nZ2xlLmNsYXNzTmFtZSkgJiYgdG9nZ2xlLmVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0b2dnbGUuY2xhc3NOYW1lKVxuICB9XG5cbiAgdGhpcy5yZW1vdmUgPSBmdW5jdGlvbigpIHtcbiAgICAvKiByZW1vdmUgY2xhc3NOYW1lIGlmIGl0J3MgdGhlcmUgKi9cbiAgICB0b2dnbGUuZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnModG9nZ2xlLmNsYXNzTmFtZSkgJiYgdG9nZ2xlLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0b2dnbGUuY2xhc3NOYW1lKVxuICB9XG5cbiAgdGhpcy51cGRhdGUgPSBmdW5jdGlvbihzZXRTdGF0ZSkge1xuICAgIGlmICghc2V0U3RhdGUuYWxyZWFkeUZpcmVkICYmIHNldFN0YXRlLnZpc2libGUpIHtcbiAgICAgIHRoaXMuYWRkKClcbiAgICAgIHNldFN0YXRlLmFscmVhZHlGaXJlZCA9IHRydWVcbiAgICB9XG5cbiAgICBpZiAoc2V0U3RhdGUuYWxyZWFkeUZpcmVkICYmICFzZXRTdGF0ZS52aXNpYmxlKSB7XG4gICAgICB0aGlzLnJlbW92ZSgpXG4gICAgICBzZXRTdGF0ZS5hbHJlYWR5RmlyZWQgPSBmYWxzZVxuICAgIH1cbiAgfVxufVxuXG5jb25zdCBzZXRUd2VlbiA9IGZ1bmN0aW9uKHRoaXM6IGFueSwgb3B0aW9ucykge1xuICBjb25zdCBnc2FwID0ge1xuICAgIHRpbWVsaW5lOiBudWxsLFxuICAgIHlveW86IGZhbHNlLFxuICAgIHNwZWVkOiAxLFxuICAgIHJldmVyc2VTcGVlZDogMSxcbiAgICBkZWxheTogMixcbiAgICAuLi5vcHRpb25zLFxuICB9XG5cbiAgaWYgKCFnc2FwLnRpbWVsaW5lKSB7XG4gICAgZXJyb3JMb2coXG4gICAgICBuYW1lU3BhY2UsXG4gICAgICBgQmUgc3VyZSB0byBzZXQgYSBjb25zdCB0bCA9IGdzYXAudGltZWxpbmUoeyBwYXVzZWQ6IHRydWUgfSkgaW4gdGhlIG5ldyAke25hbWVTcGFjZX0oeyBnc2FwOiB7IHRpbWVsaW5lOiB0bCB9IH0pYCxcbiAgICApXG4gIH1cblxuICBjb25zdCB0bCA9IGdzYXAudGltZWxpbmVcblxuICBpZiAoZ3NhcC55b3lvKSB7XG4gICAgdGwucmVwZWF0KC0xKVxuICAgICAgLnlveW8oZ3NhcC55b3lvKVxuICAgICAgLnJlcGVhdERlbGF5KGdzYXAuZGVsYXkpXG4gIH1cblxuICB0aGlzLnBsYXkgPSBmdW5jdGlvbigpIHtcbiAgICB0bC50aW1lU2NhbGUoZ3NhcC5zcGVlZCkucGxheSgpXG4gIH1cblxuICB0aGlzLnBhdXNlID0gZnVuY3Rpb24oKSB7XG4gICAgdGwucGF1c2UoKVxuICB9XG5cbiAgdGhpcy5yZXZlcnNlID0gZnVuY3Rpb24oKSB7XG4gICAgdGwudGltZVNjYWxlKGdzYXAucmV2ZXJzZVNwZWVkKS5yZXZlcnNlKClcbiAgfVxuXG4gIHRoaXMua2lsbCA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0bCkge1xuICAgICAgdGwucGF1c2UoMClcbiAgICAgIHRsLmtpbGwoKVxuICAgIH1cbiAgfVxuXG4gIHRoaXMudXBkYXRlID0gZnVuY3Rpb24oc2V0U3RhdGUpIHtcbiAgICBpZiAoIXNldFN0YXRlLmFscmVhZHlGaXJlZCAmJiBzZXRTdGF0ZS52aXNpYmxlKSB7XG4gICAgICB0aGlzLnBsYXkoKVxuICAgICAgc2V0U3RhdGUuYWxyZWFkeUZpcmVkID0gdHJ1ZVxuICAgIH1cblxuICAgIGlmIChzZXRTdGF0ZS5hbHJlYWR5RmlyZWQgJiYgIXNldFN0YXRlLnZpc2libGUpIHtcbiAgICAgIGdzYXAueW95byA/IHRoaXMucGF1c2UoKSA6IHRoaXMucmV2ZXJzZSgpXG4gICAgICBzZXRTdGF0ZS5hbHJlYWR5RmlyZWQgPSBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIHRoaXMuc2NydWIgPSBmdW5jdGlvbihpbnRlcnNlY3Rpb25SYXRpbykge1xuICAgIHRsLnByb2dyZXNzKGludGVyc2VjdGlvblJhdGlvKVxuICB9XG59XG5cbmNvbnN0IHNldFBsYXllciA9IGZ1bmN0aW9uKHRoaXM6IGFueSwgb3B0aW9ucykge1xuICBjb25zdCB2aWRlbyA9IHtcbiAgICBlbGVtZW50OiBudWxsLFxuICAgIC4uLm9wdGlvbnMsXG4gIH1cblxuICBpZiAoIXZpZGVvLmVsZW1lbnQpIHtcbiAgICBlcnJvckxvZyhcbiAgICAgIG5hbWVTcGFjZSxcbiAgICAgIGBCZSBzdXJlIHRvIHNldCBhIHZpZGVvIGVsZW1lbnQgaW4gdGhlIG5ldyAke25hbWVTcGFjZX0oeyB2aWRlbzogeyBlbGVtZW50OiB2aWRlb1JlZi5jdXJyZW50IH0gfSlgLFxuICAgIClcbiAgfVxuXG4gIHRoaXMucGxheSA9IGZ1bmN0aW9uKCkge1xuICAgIHZpZGVvLmVsZW1lbnQucGxheSgpXG4gIH1cblxuICB0aGlzLnBhdXNlID0gZnVuY3Rpb24oKSB7XG4gICAgdmlkZW8uZWxlbWVudC5wYXVzZSgpXG4gIH1cblxuICB0aGlzLmtpbGwgPSBmdW5jdGlvbigpIHtcbiAgICB2aWRlby5lbGVtZW50LnBhdXNlKClcbiAgfVxuXG4gIHRoaXMudXBkYXRlID0gZnVuY3Rpb24oc2V0U3RhdGUpIHtcbiAgICBpZiAoIXNldFN0YXRlLmFscmVhZHlGaXJlZCAmJiBzZXRTdGF0ZS52aXNpYmxlKSB7XG4gICAgICB0aGlzLnBsYXkoKVxuICAgICAgc2V0U3RhdGUuYWxyZWFkeUZpcmVkID0gdHJ1ZVxuICAgIH1cblxuICAgIGlmIChzZXRTdGF0ZS5hbHJlYWR5RmlyZWQgJiYgIXNldFN0YXRlLnZpc2libGUpIHtcbiAgICAgIHRoaXMucGF1c2UoKVxuICAgICAgc2V0U3RhdGUuYWxyZWFkeUZpcmVkID0gZmFsc2VcbiAgICB9XG4gIH1cbn1cblxuY29uc3Qgc2V0RnVuY3Rpb246IGFueSA9IGZ1bmN0aW9uKHRoaXM6IGFueSwgb3B0aW9ucykge1xuICBjb25zdCBjYWxsYmFjayA9IHtcbiAgICBhY3RpdmU6IG51bGwsXG4gICAgbm90QWN0aXZlOiBudWxsLFxuICAgIC4uLm9wdGlvbnMsXG4gIH1cblxuICBpZiAoIWNhbGxiYWNrLmFjdGl2ZSAmJiAhY2FsbGJhY2subm90QWN0aXZlKSB7XG4gICAgZXJyb3JMb2coXG4gICAgICBuYW1lU3BhY2UsXG4gICAgICBgQmUgc3VyZSB0byBzZXQgYSBjYWxsYmFjayBhY3RpdmUgb3Igbm90QWN0aXZlIGZ1bmN0aW9uIGluIHRoZSBuZXcgJHtuYW1lU3BhY2V9KHsgY2FsbGJhY2s6IHsgYWN0aXZlOiAoKSA9PiAoKSB9IH0pYCxcbiAgICApXG4gIH1cblxuICBpZiAoKGNhbGxiYWNrLmFjdGl2ZSAmJiAhaXNGdW5jKGNhbGxiYWNrLmFjdGl2ZSkpIHx8IChjYWxsYmFjay5ub3RBY3RpdmUgJiYgIWlzRnVuYyhjYWxsYmFjay5ub3RBY3RpdmUpKSkge1xuICAgIGVycm9yTG9nKG5hbWVTcGFjZSwgYEJlIHN1cmUgdG8gc2V0IHRoZSBjYWxsYmFjayBhcyBhIGZ1bmN0aW9uIGApXG4gIH1cblxuICB0aGlzLnVwZGF0ZSA9IGZ1bmN0aW9uKHNldFN0YXRlKSB7XG4gICAgaWYgKCFzZXRTdGF0ZS5hbHJlYWR5RmlyZWQgJiYgc2V0U3RhdGUudmlzaWJsZSAmJiBjYWxsYmFjay5hY3RpdmUpIHtcbiAgICAgIGNhbGxiYWNrLmFjdGl2ZSgpXG4gICAgICBzZXRTdGF0ZS5hbHJlYWR5RmlyZWQgPSB0cnVlXG4gICAgfVxuXG4gICAgaWYgKHNldFN0YXRlLmFscmVhZHlGaXJlZCAmJiAhc2V0U3RhdGUudmlzaWJsZSAmJiBjYWxsYmFjay5hY3RpdmUpIHtcbiAgICAgIGNhbGxiYWNrLm5vdEFjdGl2ZSgpXG4gICAgICBzZXRTdGF0ZS5hbHJlYWR5RmlyZWQgPSBmYWxzZVxuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIElTY3JvbGxPYnNlcnZlckdzYXAge1xuICAvKipcbiAgICogdGltZWxpbmVcbiAgICogQGRlc2MgSW5zZXJ0IHlvdXIgZ3NhcC50aW1lbGluZSBvYmplY3QgdmFyXG4gICAqIEB0eXBlIG9iamVjdFxuICAgKiBAZXhhbXBsZVxuICAgKiBjb25zdCBteVRpbWVsaW5lID0gZ3NhcC50aW1lbGluZSgpXG4gICAqIGdzYXA6IHsgdGltZWxpbmU6IG15VGltZWxpbmUgfVxuICAgKi9cbiAgdGltZWxpbmU6IGFueVxuXG4gIC8qKlxuICAgKiB5b3lvXG4gICAqIEBkZXNjIERvIHlvdSB3YW50IGdzYXAgYW5pbWF0aW9uIHRvIGxvb3AgYmFjayBhbmQgZm9ydGg/XG4gICAqIEB0eXBlIGJvb2xlYW5cbiAgICogQGRlZmF1bHQgZmFsc2VcbiAgICogQGV4YW1wbGVcbiAgICogZ3NhcDogeyB5b3lvOiB0cnVlIH1cbiAgICovXG4gIHlveW8/OiBib29sZWFuXG5cbiAgLyoqXG4gICAqIHNwZWVkXG4gICAqIEBkZXNjIFRoZSBzcGVlZCBhdCB3aGljaCB0aGUgZ3NhcCBhbmltYXRpb24gd2lsbCBwbGF5IHJlbGF0aXZlIHRvIGl0J3MgY3VycmVudCBzcGVlZC5cbiAgICogQHR5cGUgbnVtYmVyXG4gICAqIEBkZWZhdWx0IDFcbiAgICogQGV4YW1wbGVcbiAgICogZ3NhcDogeyBzcGVlZDogMiB9IC8vID0gdHdpY2UgYXMgZmFzdFxuICAgKi9cbiAgc3BlZWQ/OiBudW1iZXJcblxuICAvKipcbiAgICogc3BlZWRcbiAgICogQGRlc2MgVGhlIHNwZWVkIGF0IHdoaWNoIHRoZSBnc2FwIGFuaW1hdGlvbiB3aWxsIHJldmVyc2UgcmVsYXRpdmUgdG8gaXQncyBjdXJyZW50IHNwZWVkLlxuICAgKiBAdHlwZSBudW1iZXJcbiAgICogQGRlZmF1bHQgNFxuICAgKiBAZXhhbXBsZVxuICAgKiBnc2FwOiB7IHNwZWVkOiA0IH0gLy8gPSA0eCBhcyBmYXN0XG4gICAqL1xuICByZXZlcnNlU3BlZWQ/OiBudW1iZXJcblxuICAvKipcbiAgICogZGVsYXlcbiAgICogQGRlc2MgVGhlIGRlbGF5IChpbiBzZWNvbmRzKSBhdCB3aGljaCB0aGUgZ3NhcCBhbmltYXRpb24gd2FpdCBiZWZvcmUgcmV2ZXJzaW5nLlxuICAgKiBAdHlwZSBudW1iZXJcbiAgICogQGRlZmF1bHQgMlxuICAgKiBAZXhhbXBsZVxuICAgKiBnc2FwOiB7IGRlbGF5OiAzIH0gLy8gPSBXYWl0IDMgc2Vjb25kc1xuICAgKi9cbiAgZGVsYXk/OiBudW1iZXJcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJU2Nyb2xsT2JzZXJ2ZXJUb2dnbGUge1xuICAvKipcbiAgICogY2xhc3NOYW1lXG4gICAqIEBkZXNjIFNwZWNpZnkgdGhlIGNsYXNzTmFtZSB5b3Ugd2lzaCB0byB0b2dnbGUuXG4gICAqIEB0eXBlIHN0cmluZ1xuICAgKiBAZXhhbXBsZVxuICAgKiB0b2dnbGU6IHsgY2xhc3NOYW1lOiAndHVybi1tZS1ibHVlLWJhYnknIH1cbiAgICovXG4gIGNsYXNzTmFtZTogc3RyaW5nXG5cbiAgLyoqXG4gICAqIGVsZW1lbnRcbiAgICogQGRlc2MgU3BlY2lmeSB0aGUgZWxlbWVudCB5b3Ugd2lzaCB0byB0b2dnbGUgdGhlIGNsYXNzTmFtZSBvbi5cbiAgICogQHR5cGUgSFRNTEVsZW1lbnQgfCBhbnlcbiAgICogQGV4YW1wbGVcbiAgICogdG9nZ2xlOiB7IGVsZW1lbnQ6IGNvbnRhaW5lclJlZi5jdXJyZW50IH1cbiAgICovXG4gIGVsZW1lbnQ6IEhUTUxFbGVtZW50IHwgYW55XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVNjcm9sbE9ic2VydmVyVmlkZW8ge1xuICAvKipcbiAgICogZWxlbWVudFxuICAgKiBAZGVzYyBTcGVjaWZ5IHRoZSB2aWRlbyBlbGVtZW50IHlvdSB3aXNoIHRvIGludGVyYWN0IHdpdGguXG4gICAqIEB0eXBlIEhUTUxFbGVtZW50IHwgYW55XG4gICAqIEBleGFtcGxlXG4gICAqIHZpZGVvOiB7IGVsZW1lbnQ6IHZpZGVvUmVmLmN1cnJlbnQgfVxuICAgKi9cbiAgZWxlbWVudDogSFRNTEVsZW1lbnQgfCBhbnlcbn1cblxuaW50ZXJmYWNlIElTY3JvbGxPYnNlcnZlciB7XG4gIC8qKlxuICAgKiBicmVha3BvaW50c1xuICAgKiBAZGVzYyBVc2UgdG8gc2V0IHJlc3BvbnNpdmVuZXNzIG9mIHRoZSBTY3JvbGxPYnNlcnZlciwgbW9iaWxlLWZpcnN0XG4gICAqIEB0eXBlIG9iamVjdFxuICAgKiBAZXhhbXBsZVxuICAgKiBicmVha3BvaW50czogeyAwOiBmYWxzZSwgNzY4OiB0cnVlIH1cbiAgICovXG4gIGJyZWFrcG9pbnRzPzogb2JqZWN0XG5cbiAgLyoqXG4gICAqIGNhbGxiYWNrXG4gICAqIEBkZXNjIFVzZSB0byBzZXQgYSBjYWxsYmFjayB3aGVuIHRoZSBzY2VuZSBpcyBhY3RpdmUuXG4gICAqIEB0eXBlIG9iamVjdFxuICAgKiBAZXhhbXBsZVxuICAgKiBjYWxsYmFjazogeyBhY3RpdmU6ICgpID0+ICgpLCBub3RBY3RpdmU6ICgpID0+ICgpIH1cbiAgICovXG4gIGNhbGxiYWNrPzogb2JqZWN0XG5cbiAgLyoqXG4gICAqIGRlc3Ryb3lJbW1lZGlhdGVseVxuICAgKiBAZGVzYyBVc2UgdG8gZGVzdHJveSB0aGUgc2NlbmUgaW1tZWRpYXRlbHkgYWZ0ZXIgZmlyaW5nIG9uY2UgdGhlIGVsZW1lbnQgaXMgdmlzaWJsZS5cbiAgICogQHR5cGUgYm9vbGVhblxuICAgKiBAZXhhbXBsZVxuICAgKiBkZXN0cm95SW1tZWRpYXRlbHk6IHRydWVcbiAgICovXG4gIGRlc3Ryb3lJbW1lZGlhdGVseT86IGJvb2xlYW5cblxuICAvKipcbiAgICogZ3NhcFxuICAgKiBAZGVzYyBVc2UgdG8gc2V0IG9wdGlvbnMgZm9yIHRoZSBnc2FwIGFuaW1hdGlvbiBvZiB0aGUgU2Nyb2xsT2JzZXJ2ZXIuXG4gICAqIEB0eXBlIG9iamVjdFxuICAgKiBAZXhhbXBsZVxuICAgKiBnc2FwOiB7IHRpbWVsaW5lOiBteVRpbWVsaW5lLCB5b3lvOiB0cnVlLCByZXZlcnNlU3BlZWQ6IDIgfVxuICAgKi9cbiAgZ3NhcD86IElTY3JvbGxPYnNlcnZlckdzYXBcblxuICAvKipcbiAgICogb2JzZXJ2ZXJcbiAgICogQGRlc2MgRXh0cmEgb3B0aW9ucyB0byBwYXNzIHRoZSBJbnRlcnNlY3Rpb25PYnNlcnZlciwgbGlrZSByb290LCByb290TWFyZ2luLCB0aHJlc2hvbGQgKHRvIG92ZXJyaWRlIHRoZSB0aHJlc2hvbGRzIG9wdGlvbilcbiAgICogQHR5cGUgb2JqZWN0XG4gICAqIEBleGFtcGxlXG4gICAqIG9ic2VydmVyOiB7IHJvb3RNYXJnaW46ICctNTAlIDAlJyB9XG4gICAqL1xuICBvYnNlcnZlcj86IG9iamVjdFxuXG4gIC8qKlxuICAgKiBvZmZzZXRcbiAgICogQGRlc2MgQ2hhbmdlIHRoZSBvZmZzZXQuIFRoaXMgdXNlcyByb290TWFyZ2luIHRodXMgb25seSB3b3JrcyBhcyBhIG5lZ2F0aXZlIG9mZnNldC5cbiAgICogQHR5cGUgbnVtYmVyIHwgc3RyaW5nXG4gICAqIEBkZWZhdWx0dmFsdWUgJzAlIDAlJ1xuICAgKiBAZXhhbXBsZVxuICAgKiBvZmZzZXQ6IDUwMCAvLyB0aGlzIHdpbGwgYmUgcm9vdE1hcmdpbjogJy01MDBweCAwJSdcbiAgICovXG4gIG9mZnNldD86IG51bWJlciB8IHN0cmluZ1xuXG4gIC8qKlxuICAgKiB0aHJlc2hvbGRzXG4gICAqIEBkZXNjIFNldCB0aGUgbnVtYmVyIG9mIHRocmVzaG9sZHMgeW91IHdhbnQuXG4gICAqIEByZXR1cm5zIEFuIEFycmF5IG9mIG51bWJlciBmcm9tIDAgdG8gMS4gQWRkIDEgdG8geW91ciBudW1iZXIgdG8gYWNjb3VudCBmb3IgMC5cbiAgICogQHR5cGUgbnVtYmVyXG4gICAqIEBleGFtcGxlXG4gICAqIHRocmVzaG9sZHM6IDEgPSBbMCwgMV1cbiAgICogdGhyZXNob2xkczogMiA9IFswLCAwLjUsIDFdXG4gICAqIHRocmVzaG9sZHM6IDMgPSBbMCwgMC4zMywgMC42NywgMV1cbiAgICogdGhyZXNob2xkczogMTAwID0gWzAsIDAuMSwgMC4yLCAuLi4gMC45OCwgMC45OSwgMV1cbiAgICovXG4gIHRocmVzaG9sZHM/OiBudW1iZXJcblxuICAvKipcbiAgICogdG9nZ2xlXG4gICAqIEBkZXNjIFVzZSB0byBzZXQgdGhlIG9wdGlvbnMgZm9yIHRoZSB0b2dnbGluZyBvZiBhIGNsYXNzTmFtZVxuICAgKiBAdHlwZSBvYmplY3RcbiAgICogQGV4YW1wbGVcbiAgICogdG9nZ2xlOiB7IGVsZW1lbnQ6IGNvbnRhaW5lclJlZi5jdXJyZW50LCBjbGFzc05hbWU6ICdsZXRzLWRvLXRoaXMnIH1cbiAgICovXG4gIHRvZ2dsZT86IElTY3JvbGxPYnNlcnZlclRvZ2dsZVxuXG4gIC8qKlxuICAgKiB0cmlnZ2VyRWxlbWVudFxuICAgKiBAZGVzYyBTZXQgdGhlIGVsZW1lbnQgeW91IHdpc2ggdG8gdHJpZ2dlciBldmVudHMgYmFzZWQgdXBvbiwgdGhlIG9ic2VydmVkIGVsZW1lbnQuXG4gICAqIEB0eXBlIEhUTUxFbGVtZW50IHwgYW55XG4gICAqIEBleGFtcGxlXG4gICAqIHRyaWdnZXJFbGVtZW50OiB0cmlnZ2VyUmVmLmN1cnJlbnRcbiAgICovXG4gIHRyaWdnZXJFbGVtZW50OiBIVE1MRWxlbWVudCB8IGFueVxuXG4gIC8qKlxuICAgKiB1c2VEdXJhdGlvblxuICAgKiBAZGVzYyBVc2UgdGhlIHBlcmNlbnRhZ2Ugb2YgZWxlbWVudCB2aXNpYmlsaXR5IHRvIHNjcnViIHRoZSBnc2FwIHRpbWVsaW5lLlxuICAgKiBAdHlwZSBib29sZWFuXG4gICAqIEBleGFtcGxlXG4gICAqIHVzZUR1cmF0aW9uOiB0cnVlXG4gICAqL1xuICB1c2VEdXJhdGlvbj86IGJvb2xlYW5cblxuICAvKipcbiAgICogdmlkZW9cbiAgICogQGRlc2MgVXNlIHRvIHNldCB0aGUgb3B0aW9ucyBmb3IgcGxheWluZyBhbmQgcGF1c2luZyBvZiB0aGUgdmlkZW8uXG4gICAqIEB0eXBlIG9iamVjdFxuICAgKiBAZXhhbXBsZVxuICAgKiB2aWRlbzogeyBlbGVtZW50OiB2aWRlb1JlZi5jdXJyZW50IH1cbiAgICovXG4gIHZpZGVvPzogSVNjcm9sbE9ic2VydmVyVmlkZW9cblxuICAvKipcbiAgICogd2hlblZpc2libGVcbiAgICogQGRlc2MgU2V0IHdoZW4gdGhlIHNjZW5lIHNob3VsZCBiZSBhY3RpdmUgYmFzZWQgb24gdGhlIHBlcmNlbnRhZ2Ugb2YgdGhlIGVsZW1lbnQgdmlzaWJsZVxuICAgKiBAdHlwZSBudW1iZXJcbiAgICogQGV4YW1wbGVcbiAgICogd2hlblZpc2libGU6ICc1MCUnXG4gICAqL1xuICB3aGVuVmlzaWJsZT86IHN0cmluZ1xufVxuXG5jb25zdCBTY3JvbGxPYnNlcnZlciA9IGZ1bmN0aW9uKFxuICB0aGlzOiBhbnksXG4gIHtcbiAgICBicmVha3BvaW50cyxcbiAgICBjYWxsYmFjayxcbiAgICBkZXN0cm95SW1tZWRpYXRlbHksXG4gICAgZ3NhcCxcbiAgICBvYnNlcnZlcixcbiAgICBvZmZzZXQsXG4gICAgd2hlblZpc2libGUsXG4gICAgdGhyZXNob2xkcyxcbiAgICB0b2dnbGUsXG4gICAgdHJpZ2dlckVsZW1lbnQsXG4gICAgdXNlRHVyYXRpb24sXG4gICAgdmlkZW8sXG4gIH06IElTY3JvbGxPYnNlcnZlcixcbikge1xuICBpZiAoIXRyaWdnZXJFbGVtZW50KSB7XG4gICAgZXJyb3JMb2coXG4gICAgICBuYW1lU3BhY2UsXG4gICAgICAnQmUgc3VyZSB0byBzZXQgYSBjb25zdCB0cmlnZ2VyRWxlbWVudCA9IChyZWFjdFJlZi5jdXJyZW50IG9yIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IpIGluIHRoZSBuZXcgU2Nyb2xsU2NlbmUoeyB0cmlnZ2VyRWxlbWVudDogdHJpZ2dlckVsZW1lbnQgfSknLFxuICAgIClcbiAgfVxuXG4gIGNvbnN0ICR0aGlzID0gdGhpc1xuICBsZXQgc2V0VG9nZ2xlXG4gIGxldCBzZXRHc2FwXG4gIGxldCBzZXRWaWRlb1xuICBsZXQgc2V0Q2FsbGJhY2tcbiAgbGV0IHJhdGlvXG4gIGxldCBzZXRSb290TWFyZ2luID0gJzAlIDAlJ1xuICBsZXQgc2V0U3RhdGUgPSBuZXcgc3RhdGUoZmFsc2UsIGZhbHNlKVxuXG4gIGlmICh0eXBlb2Ygb2Zmc2V0ID09PSAnbnVtYmVyJykge1xuICAgIC8vIHByb3RlY3QgYWdhaW5zdCBwb3NpdGl2ZSBweCB2YWx1ZXMsIGZvciBub3dcbiAgICBzZXRSb290TWFyZ2luID0gYC0ke01hdGguYWJzKG9mZnNldCl9cHggMCVgXG4gIH0gZWxzZSBpZiAodHlwZW9mIG9mZnNldCA9PT0gJ3N0cmluZycpIHtcbiAgICAvLyBwcm90ZWN0IGFnYWluc3QgcG9zaXRpdmUgcGVyY2VudGFnZSB2YWx1ZXMsIGZvciBub3dcbiAgICBzZXRSb290TWFyZ2luID0gYC0ke01hdGguYWJzKHBhcnNlRmxvYXQob2Zmc2V0KSl9JSAwJWBcbiAgfVxuXG4gIGlmICh0b2dnbGUgJiYgaXNPYmplY3QodG9nZ2xlKSkge1xuICAgIHNldFRvZ2dsZSA9IG5ldyBzZXRDbGFzc05hbWUodG9nZ2xlKVxuICB9XG5cbiAgaWYgKGdzYXAgJiYgaXNPYmplY3QoZ3NhcCkpIHtcbiAgICBzZXRHc2FwID0gbmV3IHNldFR3ZWVuKGdzYXApXG4gIH1cblxuICBpZiAodmlkZW8gJiYgaXNPYmplY3QodmlkZW8pKSB7XG4gICAgc2V0VmlkZW8gPSBuZXcgc2V0UGxheWVyKHZpZGVvKVxuICB9XG5cbiAgaWYgKGNhbGxiYWNrKSB7XG4gICAgc2V0Q2FsbGJhY2sgPSBuZXcgc2V0RnVuY3Rpb24oY2FsbGJhY2spXG4gIH1cblxuICBjb25zdCBvYnNlcnZlckNhbGxiYWNrID0gZnVuY3Rpb24oZW50cmllcykge1xuICAgIGVudHJpZXMuZm9yRWFjaCgoeyBpc0ludGVyc2VjdGluZywgaW50ZXJzZWN0aW9uUmF0aW8gfSkgPT4ge1xuICAgICAgLypcbiAgICAgICAqIFRvIGhlbHAgdGhlIHdvbmtpbmVzcyBvZiBJbnRlcnNlY3Rpb25PYnNlcnZlciwgaXNJbnRlcnNlY3RpbmcgZmlyaW5nIHRydWUgd2hlbiBpdCdzIHJlYWxseSBmYWxzZVxuICAgICAgICovXG4gICAgICBpZiAocmF0aW8pIHtcbiAgICAgICAgc2V0U3RhdGUudmlzaWJsZSA9IGludGVyc2VjdGlvblJhdGlvID49IHJhdGlvXG4gICAgICB9IGVsc2UgaWYgKGlzSW50ZXJzZWN0aW5nICYmICFzZXRTdGF0ZS52aXNpYmxlKSB7XG4gICAgICAgIC8qXG4gICAgICAgICAqIFRvIGhlbHAgd2l0aCBzZXRDYWxsYmFjayBhbmQgaWdub3JpbmcgcmVmaXJpbmcgZXh0cmEgZnVuY3Rpb25cbiAgICAgICAgICogY2FsbHMgZHVlIHRvIGludGVyc2VjdGlvblJhdGlvXG4gICAgICAgICAqL1xuICAgICAgICBzZXRTdGF0ZS52aXNpYmxlID0gdHJ1ZVxuICAgICAgfSBlbHNlIGlmICghaXNJbnRlcnNlY3RpbmcgJiYgc2V0U3RhdGUudmlzaWJsZSkge1xuICAgICAgICBzZXRTdGF0ZS52aXNpYmxlID0gZmFsc2VcbiAgICAgIH1cblxuICAgICAgc2V0VG9nZ2xlICYmIHNldFRvZ2dsZS51cGRhdGUoc2V0U3RhdGUpXG4gICAgICBzZXRHc2FwICYmICghdXNlRHVyYXRpb24gPyBzZXRHc2FwLnVwZGF0ZShzZXRTdGF0ZSkgOiBzZXRHc2FwLnNjcnViKGludGVyc2VjdGlvblJhdGlvKSlcbiAgICAgIHNldFZpZGVvICYmIHNldFZpZGVvLnVwZGF0ZShzZXRTdGF0ZSlcbiAgICAgIHNldENhbGxiYWNrICYmIHNldENhbGxiYWNrLnVwZGF0ZShzZXRTdGF0ZSlcblxuICAgICAgaWYgKGlzSW50ZXJzZWN0aW5nICYmIGRlc3Ryb3lJbW1lZGlhdGVseSkge1xuICAgICAgICAvKlxuICAgICAgICAgKiBkZXN0cm95IHRoZSBzY2VuZSBhZnRlciB1c2VkIG9uY2VcbiAgICAgICAgICovXG4gICAgICAgICR0aGlzLmRlc3Ryb3koKVxuICAgICAgfVxuICAgIH0pXG4gIH1cblxuICBjb25zdCBnZXRQZXJjZW50YWdlID0gdmFsdWUgPT4ge1xuICAgIGlmICghaXNTdHJpbmcod2hlblZpc2libGUpICYmICFzdHJpbmdDb250YWlucyh3aGVuVmlzaWJsZSwgJyUnKSkge1xuICAgICAgZXJyb3JMb2cobmFtZVNwYWNlLCAnQmUgc3VyZSB0byBzZXQgYSBwZXJjZW50YWdlIGFzIGEgc3RyaW5nLiB7IHdoZW5WaXNpYmxlOiBcIjUwJVwiIH0nKVxuICAgIH1cblxuICAgIGNvbnN0IHBhcnNlZCA9IHBhcnNlSW50KHZhbHVlLnJlcGxhY2UoJyUnLCAnJykpIC8gMTAwXG5cbiAgICByYXRpbyA9IHBhcnNlZFxuXG4gICAgcmV0dXJuIHBhcnNlZFxuICB9XG5cbiAgY29uc3QgZ2V0VGhyZXNvbGRzID0gKCkgPT4ge1xuICAgIGNvbnN0IGRlZmF1bHRzID0ge1xuICAgICAgb25lOiBbMCwgMV0sXG4gICAgICBnc2FwOiBjcmVhdGVBcnJheSgxOTkpLFxuICAgIH1cblxuICAgIGxldCByZXR1cm5lZFRocmVzaG9sZHM6IGFueSA9IGRlZmF1bHRzLm9uZVxuXG4gICAgaWYgKHdoZW5WaXNpYmxlKSB7XG4gICAgICByZXR1cm5lZFRocmVzaG9sZHMgPSBnZXRQZXJjZW50YWdlKHdoZW5WaXNpYmxlKVxuICAgIH1cblxuICAgIGlmICh1c2VEdXJhdGlvbikge1xuICAgICAgcmV0dXJuZWRUaHJlc2hvbGRzID0gZGVmYXVsdHMuZ3NhcFxuICAgIH1cblxuICAgIGlmICh0aHJlc2hvbGRzKSB7XG4gICAgICByZXR1cm5lZFRocmVzaG9sZHMgPSBjcmVhdGVBcnJheSh0aHJlc2hvbGRzKVxuICAgIH1cblxuICAgIHJldHVybiByZXR1cm5lZFRocmVzaG9sZHNcbiAgfVxuXG4gIGNvbnN0IE9ic2VydmVyID0gbmV3IEludGVyc2VjdGlvbk9ic2VydmVyKG9ic2VydmVyQ2FsbGJhY2ssIHtcbiAgICB0aHJlc2hvbGQ6IGdldFRocmVzb2xkcygpLFxuICAgIHJvb3RNYXJnaW46IHNldFJvb3RNYXJnaW4sXG4gICAgLi4ub2JzZXJ2ZXIsXG4gIH0pXG5cbiAgdGhpcy5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgT2JzZXJ2ZXIub2JzZXJ2ZSh0cmlnZ2VyRWxlbWVudClcbiAgfVxuXG4gIHRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0cmlnZ2VyRWxlbWVudCAmJiBPYnNlcnZlcikge1xuICAgICAgaWYgKHNldFRvZ2dsZSkge1xuICAgICAgICBzZXRUb2dnbGUucmVtb3ZlKClcbiAgICAgIH1cblxuICAgICAgaWYgKHNldEdzYXApIHtcbiAgICAgICAgc2V0R3NhcC5raWxsKClcbiAgICAgIH1cblxuICAgICAgaWYgKHNldFZpZGVvKSB7XG4gICAgICAgIHNldFZpZGVvLmtpbGwoKVxuICAgICAgfVxuXG4gICAgICBPYnNlcnZlci51bm9ic2VydmUodHJpZ2dlckVsZW1lbnQpXG4gICAgfVxuICB9XG5cbiAgc2Nyb2xsQW5pbWF0aW9uSW5pdChicmVha3BvaW50cywgdGhpcy5pbml0LCB0aGlzLmRlc3Ryb3kpXG59XG5cbmV4cG9ydCB7IFNjcm9sbE9ic2VydmVyIH1cbiJdfQ==