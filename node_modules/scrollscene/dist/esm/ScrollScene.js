import _defineProperty from "@babel/runtime/helpers/esm/defineProperty";

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

import ScrollMagic from "./scrollmagic-with-ssr";
import throttle from 'lodash.throttle';
import { errorLog, isObject, scrollAnimationInit } from "./helpers";
var nameSpace = 'ScrollScene';

var updateTweenProgress = function updateTweenProgress(Scene, Tween, gsapForwardSpeed, gsapReverseSpeed) {
  if (Tween) {
    var progress = Scene.progress();
    var state = Scene.state();

    if (Tween.repeat && Tween.repeat() === -1) {
      if (state === 'DURING' && Tween.paused()) {
        Tween.timeScale(gsapForwardSpeed).play();
      } else if (state !== 'DURING' && !Tween.paused()) {
        Tween.pause();
      }
    } else if (progress != Tween.progress()) {
      if (Scene.duration() === 0) {
        if (progress > 0) {
          Tween.timeScale(gsapForwardSpeed).play();
        } else {
          Tween.timeScale(gsapReverseSpeed).reverse();
        }
      } else {
        Tween.progress(progress).pause();
      }
    }
  }
};

var removeTween = function removeTween(Tween) {
  if (Tween) {
    Tween.pause(0);
    Tween.kill();
  }
};

var setDuration = function setDuration(Scene, duration) {
  if (isObject(duration)) {
    var keys = Object.keys(duration).reverse();

    var fn = function fn() {
      for (var index = 0; index < keys.length; index++) {
        var breakpoint = parseFloat(keys[index]);

        if (breakpoint <= window.innerWidth) {
          Scene.duration(duration[breakpoint]);
          break;
        }
      }
    };

    fn();
    window.addEventListener('resize', throttle(fn, 700));
  } else {
    Scene.duration(duration);
  }
};

var setClassName = function setClassName(Scene, options, duration) {
  var toggle = _objectSpread({
    className: null,
    element: null,
    reverse: false
  }, options);

  if (!toggle.className) {
    errorLog(nameSpace, "Be sure to set a className in the new ".concat(nameSpace, "({ toggle: { className: \"my-class\" } })"));
  }

  if (!toggle.element) {
    errorLog(nameSpace, "Be sure to set a const toggleElement = (reactRef.current or document.querySelector) in the new ".concat(nameSpace, "({ toggle: { element: toggleElement } })"));
  }

  var addClassName = function addClassName() {
    return !toggle.element.classList.contains(toggle.className) && toggle.element.classList.add(toggle.className);
  };

  var removeClassName = function removeClassName() {
    return toggle.element.classList.contains(toggle.className) && toggle.element.classList.remove(toggle.className);
  };

  Scene.on('enter', function () {
    addClassName();
  });
  Scene.on('add', function () {
    if (Scene.state() === 'DURING') {
      addClassName();
    }
  });
  Scene.on('leave', function (event) {
    if (!toggle.reverse && duration) {
      event.scrollDirection === 'REVERSE' && removeClassName();
    } else {
      removeClassName();
    }
  });
  Scene.on('remove', function () {
    removeClassName();
  });
};

var setTween = function setTween(Scene, options) {
  var gsap = _objectSpread({
    forwardSpeed: 1,
    reverseSpeed: 1,
    timeline: null
  }, options);

  if (!gsap.timeline) {
    errorLog(nameSpace, "Be sure to set a const tl = gsap.timeline({ paused: true }) in the new ".concat(nameSpace, "({ gsap: { timeline: tl } })"));
  }

  Scene.on('progress', function () {
    updateTweenProgress(Scene, gsap.timeline, gsap.forwardSpeed, gsap.reverseSpeed);
  });
  Scene.on('remove', function () {
    removeTween(gsap.timeline);
  });
};

var globalController;

var ScrollScene = function ScrollScene(_ref) {
  var breakpoints = _ref.breakpoints,
      _ref$controller = _ref.controller,
      controller = _ref$controller === void 0 ? {} : _ref$controller,
      duration = _ref.duration,
      gsap = _ref.gsap,
      _ref$offset = _ref.offset,
      offset = _ref$offset === void 0 ? 0 : _ref$offset,
      _ref$scene = _ref.scene,
      scene = _ref$scene === void 0 ? {} : _ref$scene,
      toggle = _ref.toggle,
      triggerElement = _ref.triggerElement,
      _ref$triggerHook = _ref.triggerHook,
      triggerHook = _ref$triggerHook === void 0 ? 'onEnter' : _ref$triggerHook,
      _ref$useGlobalControl = _ref.useGlobalController,
      useGlobalController = _ref$useGlobalControl === void 0 ? true : _ref$useGlobalControl;
  var localController;

  if (!useGlobalController) {
    localController = new ScrollMagic.Controller(controller);
  }

  if (!globalController && useGlobalController) {
    globalController = new ScrollMagic.Controller(controller);
  }

  var controllerIsUse = localController ? localController : globalController;

  if (!triggerElement) {
    errorLog(nameSpace, "Be sure to set a const triggerElement = (reactRef.current or document.querySelector) in the new ".concat(nameSpace, "({ triggerElement: triggerElement })"));
  }

  var Scene = new ScrollMagic.Scene(_objectSpread({
    triggerElement: triggerElement,
    triggerHook: triggerHook,
    offset: offset
  }, scene));

  if (duration) {
    setDuration(Scene, duration);
  }

  if (toggle && isObject(toggle)) {
    setClassName(Scene, toggle, duration);
  }

  if (gsap && isObject(gsap)) {
    setTween(Scene, gsap);
  }

  this.init = function () {
    controllerIsUse && Scene.addTo(controllerIsUse);
  };

  this.destroy = function () {
    Scene.remove();
  };

  this.Scene = Scene;
  this.Controller = controllerIsUse;
  scrollAnimationInit(breakpoints, this.init, this.destroy);
};

export { ScrollScene };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9TY3JvbGxTY2VuZS50cyJdLCJuYW1lcyI6WyJTY3JvbGxNYWdpYyIsInRocm90dGxlIiwiZXJyb3JMb2ciLCJpc09iamVjdCIsInNjcm9sbEFuaW1hdGlvbkluaXQiLCJuYW1lU3BhY2UiLCJ1cGRhdGVUd2VlblByb2dyZXNzIiwiU2NlbmUiLCJUd2VlbiIsImdzYXBGb3J3YXJkU3BlZWQiLCJnc2FwUmV2ZXJzZVNwZWVkIiwicHJvZ3Jlc3MiLCJzdGF0ZSIsInJlcGVhdCIsInBhdXNlZCIsInRpbWVTY2FsZSIsInBsYXkiLCJwYXVzZSIsImR1cmF0aW9uIiwicmV2ZXJzZSIsInJlbW92ZVR3ZWVuIiwia2lsbCIsInNldER1cmF0aW9uIiwia2V5cyIsIk9iamVjdCIsImZuIiwiaW5kZXgiLCJsZW5ndGgiLCJicmVha3BvaW50IiwicGFyc2VGbG9hdCIsIndpbmRvdyIsImlubmVyV2lkdGgiLCJhZGRFdmVudExpc3RlbmVyIiwic2V0Q2xhc3NOYW1lIiwib3B0aW9ucyIsInRvZ2dsZSIsImNsYXNzTmFtZSIsImVsZW1lbnQiLCJhZGRDbGFzc05hbWUiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsImFkZCIsInJlbW92ZUNsYXNzTmFtZSIsInJlbW92ZSIsIm9uIiwiZXZlbnQiLCJzY3JvbGxEaXJlY3Rpb24iLCJzZXRUd2VlbiIsImdzYXAiLCJmb3J3YXJkU3BlZWQiLCJyZXZlcnNlU3BlZWQiLCJ0aW1lbGluZSIsImdsb2JhbENvbnRyb2xsZXIiLCJTY3JvbGxTY2VuZSIsImJyZWFrcG9pbnRzIiwiY29udHJvbGxlciIsIm9mZnNldCIsInNjZW5lIiwidHJpZ2dlckVsZW1lbnQiLCJ0cmlnZ2VySG9vayIsInVzZUdsb2JhbENvbnRyb2xsZXIiLCJsb2NhbENvbnRyb2xsZXIiLCJDb250cm9sbGVyIiwiY29udHJvbGxlcklzVXNlIiwiaW5pdCIsImFkZFRvIiwiZGVzdHJveSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBT0EsV0FBUDtB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QUNabUQsSUFBQUEsY0FBYyxFQUFkQSxjQURZO0FBRVpDLElBQUFBLFdBQVcsRUFBWEEsV0FGWTtBQUdaSCxJQUFBQSxNQUFNLEVBQU5BO0FBSFksS0FJVEMsS0FKUyxFQUFkOztBQU9BLE1BQUl2QyxRQUFKLEVBQWM7QUFDWkksSUFBQUEsV0FBVyxDQUFDZixLQUFELEVBQVFXLFFBQVIsQ0FBWDtBQUNEOztBQUVELE1BQUlpQixNQUFNLElBQUloQyxRQUFRLENBQUNnQyxNQUFELENBQXRCLEVBQWdDO0FBQzlCRixJQUFBQSxZQUFZLENBQUMxQixLQUFELEVBQVE0QixNQUFSLEVBQWdCakIsUUFBaEIsQ0FBWjtBQUNEOztBQUVELE1BQUk4QixJQUFJLElBQUk3QyxRQUFRLENBQUM2QyxJQUFELENBQXBCLEVBQTRCO0FBQzFCRCxJQUFBQSxRQUFRLENBQUN4QyxLQUFELEVBQVF5QyxJQUFSLENBQVI7QUFDRDs7QUFFRCxPQUFLZ0IsSUFBTCxHQUFZLFlBQVc7QUFDckJELElBQUFBLGVBQWUsSUFBSXhELEtBQUssQ0FBQzBELEtBQU4sQ0FBWUYsZUFBWixDQUFuQjtBQUNELEdBRkQ7O0FBSUEsT0FBS0csT0FBTCxHQUFlLFlBQVc7QUFDeEIzRCxJQUFBQSxLQUFLLENBQUNvQyxNQUFOO0FBQ0QsR0FGRDs7QUFJQSxPQUFLcEMsS0FBTCxHQUFhQSxLQUFiO0FBQ0EsT0FBS3VELFVBQUwsR0FBa0JDLGVBQWxCO0FBRUEzRCxFQUFBQSxtQkFBbUIsQ0FBQ2tELFdBQUQsRUFBYyxLQUFLVSxJQUFuQixFQUF5QixLQUFLRSxPQUE5QixDQUFuQjtBQUNELENBbkVEOztBQXFFQSxTQUFTYixXQUFUIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFNjcm9sbE1hZ2ljIGZyb20gJy4vc2Nyb2xsbWFnaWMtd2l0aC1zc3InXG5pbXBvcnQgdGhyb3R0bGUgZnJvbSAnbG9kYXNoLnRocm90dGxlJ1xuaW1wb3J0IHsgZXJyb3JMb2csIGlzT2JqZWN0LCBzY3JvbGxBbmltYXRpb25Jbml0IH0gZnJvbSAnLi9oZWxwZXJzJ1xuaW1wb3J0IHsgSVNjcm9sbE9ic2VydmVyVG9nZ2xlLCBJU2Nyb2xsT2JzZXJ2ZXJHc2FwIH0gZnJvbSAnLi9TY3JvbGxPYnNlcnZlcidcblxuY29uc3QgbmFtZVNwYWNlID0gJ1Njcm9sbFNjZW5lJ1xuXG5jb25zdCB1cGRhdGVUd2VlblByb2dyZXNzID0gZnVuY3Rpb24oU2NlbmUsIFR3ZWVuLCBnc2FwRm9yd2FyZFNwZWVkLCBnc2FwUmV2ZXJzZVNwZWVkKSB7XG4gIGlmIChUd2Vlbikge1xuICAgIGNvbnN0IHByb2dyZXNzID0gU2NlbmUucHJvZ3Jlc3MoKVxuICAgIGNvbnN0IHN0YXRlID0gU2NlbmUuc3RhdGUoKVxuICAgIGlmIChUd2Vlbi5yZXBlYXQgJiYgVHdlZW4ucmVwZWF0KCkgPT09IC0xKSB7XG4gICAgICAvLyBpbmZpbml0ZSBsb29wLCBzbyBub3QgaW4gcmVsYXRpb24gdG8gcHJvZ3Jlc3NcbiAgICAgIGlmIChzdGF0ZSA9PT0gJ0RVUklORycgJiYgVHdlZW4ucGF1c2VkKCkpIHtcbiAgICAgICAgVHdlZW4udGltZVNjYWxlKGdzYXBGb3J3YXJkU3BlZWQpLnBsYXkoKVxuICAgICAgfSBlbHNlIGlmIChzdGF0ZSAhPT0gJ0RVUklORycgJiYgIVR3ZWVuLnBhdXNlZCgpKSB7XG4gICAgICAgIFR3ZWVuLnBhdXNlKClcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHByb2dyZXNzICE9IFR3ZWVuLnByb2dyZXNzKCkpIHtcbiAgICAgIC8vIGRvIHdlIGV2ZW4gbmVlZCB0byB1cGRhdGUgdGhlIHByb2dyZXNzP1xuICAgICAgLy8gbm8gaW5maW5pdGUgbG9vcCAtIHNvIHNob3VsZCB3ZSBqdXN0IHBsYXkgb3IgZ28gdG8gYSBzcGVjaWZpYyBwb2ludCBpbiB0aW1lP1xuICAgICAgaWYgKFNjZW5lLmR1cmF0aW9uKCkgPT09IDApIHtcbiAgICAgICAgLy8gcGxheSB0aGUgYW5pbWF0aW9uXG4gICAgICAgIGlmIChwcm9ncmVzcyA+IDApIHtcbiAgICAgICAgICAvLyBwbGF5IGZyb20gMCB0byAxXG4gICAgICAgICAgVHdlZW4udGltZVNjYWxlKGdzYXBGb3J3YXJkU3BlZWQpLnBsYXkoKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIHBsYXkgZnJvbSAxIHRvIDBcbiAgICAgICAgICBUd2Vlbi50aW1lU2NhbGUoZ3NhcFJldmVyc2VTcGVlZCkucmV2ZXJzZSgpXG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGdvIHRvIGEgc3BlY2lmaWMgcG9pbnQgaW4gdGltZVxuICAgICAgICAvLyBqdXN0IGhhcmQgc2V0IGl0XG4gICAgICAgIFR3ZWVuLnByb2dyZXNzKHByb2dyZXNzKS5wYXVzZSgpXG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmNvbnN0IHJlbW92ZVR3ZWVuID0gZnVuY3Rpb24oVHdlZW4pIHtcbiAgaWYgKFR3ZWVuKSB7XG4gICAgVHdlZW4ucGF1c2UoMClcbiAgICBUd2Vlbi5raWxsKClcbiAgfVxufVxuXG5jb25zdCBzZXREdXJhdGlvbiA9IChTY2VuZSwgZHVyYXRpb24pID0+IHtcbiAgaWYgKGlzT2JqZWN0KGR1cmF0aW9uKSkge1xuICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhkdXJhdGlvbikucmV2ZXJzZSgpXG5cbiAgICBjb25zdCBmbiA9ICgpID0+IHtcbiAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBrZXlzLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICBjb25zdCBicmVha3BvaW50ID0gcGFyc2VGbG9hdChrZXlzW2luZGV4XSlcblxuICAgICAgICBpZiAoYnJlYWtwb2ludCA8PSB3aW5kb3cuaW5uZXJXaWR0aCkge1xuICAgICAgICAgIFNjZW5lLmR1cmF0aW9uKGR1cmF0aW9uW2JyZWFrcG9pbnRdKVxuICAgICAgICAgIGJyZWFrXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBmbigpXG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhyb3R0bGUoZm4sIDcwMCkpXG4gIH0gZWxzZSB7XG4gICAgU2NlbmUuZHVyYXRpb24oZHVyYXRpb24pXG4gIH1cbn1cblxuY29uc3Qgc2V0Q2xhc3NOYW1lID0gKFNjZW5lLCBvcHRpb25zLCBkdXJhdGlvbikgPT4ge1xuICBjb25zdCB0b2dnbGUgPSB7XG4gICAgY2xhc3NOYW1lOiBudWxsLFxuICAgIGVsZW1lbnQ6IG51bGwsXG4gICAgcmV2ZXJzZTogZmFsc2UsXG4gICAgLi4ub3B0aW9ucyxcbiAgfVxuXG4gIGlmICghdG9nZ2xlLmNsYXNzTmFtZSkge1xuICAgIGVycm9yTG9nKG5hbWVTcGFjZSwgYEJlIHN1cmUgdG8gc2V0IGEgY2xhc3NOYW1lIGluIHRoZSBuZXcgJHtuYW1lU3BhY2V9KHsgdG9nZ2xlOiB7IGNsYXNzTmFtZTogXCJteS1jbGFzc1wiIH0gfSlgKVxuICB9XG5cbiAgaWYgKCF0b2dnbGUuZWxlbWVudCkge1xuICAgIGVycm9yTG9nKFxuICAgICAgbmFtZVNwYWNlLFxuICAgICAgYEJlIHN1cmUgdG8gc2V0IGEgY29uc3QgdG9nZ2xlRWxlbWVudCA9IChyZWFjdFJlZi5jdXJyZW50IG9yIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IpIGluIHRoZSBuZXcgJHtuYW1lU3BhY2V9KHsgdG9nZ2xlOiB7IGVsZW1lbnQ6IHRvZ2dsZUVsZW1lbnQgfSB9KWAsXG4gICAgKVxuICB9XG5cbiAgY29uc3QgYWRkQ2xhc3NOYW1lID0gKCkgPT5cbiAgICAhdG9nZ2xlLmVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKHRvZ2dsZS5jbGFzc05hbWUpICYmIHRvZ2dsZS5lbGVtZW50LmNsYXNzTGlzdC5hZGQodG9nZ2xlLmNsYXNzTmFtZSlcblxuICBjb25zdCByZW1vdmVDbGFzc05hbWUgPSAoKSA9PlxuICAgIHRvZ2dsZS5lbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyh0b2dnbGUuY2xhc3NOYW1lKSAmJiB0b2dnbGUuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRvZ2dsZS5jbGFzc05hbWUpXG5cbiAgU2NlbmUub24oJ2VudGVyJywgZnVuY3Rpb24oKSB7XG4gICAgYWRkQ2xhc3NOYW1lKClcbiAgfSlcblxuICBTY2VuZS5vbignYWRkJywgZnVuY3Rpb24oKSB7XG4gICAgaWYgKFNjZW5lLnN0YXRlKCkgPT09ICdEVVJJTkcnKSB7XG4gICAgICBhZGRDbGFzc05hbWUoKVxuICAgIH1cbiAgfSlcblxuICBTY2VuZS5vbignbGVhdmUnLCBmdW5jdGlvbihldmVudCkge1xuICAgIGlmICghdG9nZ2xlLnJldmVyc2UgJiYgZHVyYXRpb24pIHtcbiAgICAgIC8vIG5lZWRzIHRvIGJlIGJhc2VkIG9uIHdoZXRoZXIgb3Igbm90IHdlIGhhdmUgYSBkdXJhdGlvblxuICAgICAgZXZlbnQuc2Nyb2xsRGlyZWN0aW9uID09PSAnUkVWRVJTRScgJiYgcmVtb3ZlQ2xhc3NOYW1lKClcbiAgICB9IGVsc2Uge1xuICAgICAgcmVtb3ZlQ2xhc3NOYW1lKClcbiAgICB9XG4gIH0pXG5cbiAgU2NlbmUub24oJ3JlbW92ZScsIGZ1bmN0aW9uKCkge1xuICAgIHJlbW92ZUNsYXNzTmFtZSgpXG4gIH0pXG59XG5cbmNvbnN0IHNldFR3ZWVuID0gKFNjZW5lLCBvcHRpb25zKSA9PiB7XG4gIGNvbnN0IGdzYXAgPSB7XG4gICAgZm9yd2FyZFNwZWVkOiAxLFxuICAgIHJldmVyc2VTcGVlZDogMSxcbiAgICB0aW1lbGluZTogbnVsbCxcbiAgICAuLi5vcHRpb25zLFxuICB9XG5cbiAgaWYgKCFnc2FwLnRpbWVsaW5lKSB7XG4gICAgZXJyb3JMb2coXG4gICAgICBuYW1lU3BhY2UsXG4gICAgICBgQmUgc3VyZSB0byBzZXQgYSBjb25zdCB0bCA9IGdzYXAudGltZWxpbmUoeyBwYXVzZWQ6IHRydWUgfSkgaW4gdGhlIG5ldyAke25hbWVTcGFjZX0oeyBnc2FwOiB7IHRpbWVsaW5lOiB0bCB9IH0pYCxcbiAgICApXG4gIH1cblxuICBTY2VuZS5vbigncHJvZ3Jlc3MnLCBmdW5jdGlvbigpIHtcbiAgICB1cGRhdGVUd2VlblByb2dyZXNzKFNjZW5lLCBnc2FwLnRpbWVsaW5lLCBnc2FwLmZvcndhcmRTcGVlZCwgZ3NhcC5yZXZlcnNlU3BlZWQpXG4gIH0pXG5cbiAgU2NlbmUub24oJ3JlbW92ZScsIGZ1bmN0aW9uKCkge1xuICAgIHJlbW92ZVR3ZWVuKGdzYXAudGltZWxpbmUpXG4gIH0pXG59XG5cbmludGVyZmFjZSBJU2Nyb2xsU2NlbmVUb2dnbGUgZXh0ZW5kcyBJU2Nyb2xsT2JzZXJ2ZXJUb2dnbGUge1xuICAvKipcbiAgICogcmV2ZXJzZVxuICAgKiBAZGVzYyBTcGVjaWZ5IHRoZSBjbGFzc05hbWUgc2hvdWxkIGJlIHJlbW92ZWQgYWZ0ZXIgdGhlIGR1cmF0aW9uIG9mIHNjZW5lIGlzIG1ldC4gT25seSBhcHBsaWVzIGlmIHNjZW5lIGhhcyBkdXJhdGlvbi5cbiAgICogQHR5cGUgYm9vbGVhblxuICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgKiBAZXhhbXBsZVxuICAgKiB0b2dnbGU6IHsgcmV2ZXJzZTogdHJ1ZSB9XG4gICAqL1xuICByZXZlcnNlPzogYm9vbGVhblxufVxuXG5pbnRlcmZhY2UgSVNjcm9sbFNjZW5lIHtcbiAgLyoqXG4gICAqIGJyZWFrcG9pbnRzXG4gICAqIEBkZXNjIFVzZSB0byBzZXQgcmVzcG9uc2l2ZW5lc3Mgb2YgdGhlIG5ldyBTY3JvbGxNYWdpYy5TY2VuZSwgbW9iaWxlLWZpcnN0XG4gICAqIEB0eXBlIG9iamVjdFxuICAgKiBAZXhhbXBsZVxuICAgKiBicmVha3BvaW50czogeyAwOiBmYWxzZSwgNzY4OiB0cnVlIH1cbiAgICovXG4gIGJyZWFrcG9pbnRzPzogb2JqZWN0XG5cbiAgLyoqXG4gICAqIGNvbnRyb2xsZXJcbiAgICogQGRlc2MgRXh0cmEgb3B0aW9ucyB0byBwYXNzIHRoZSBuZXcgU2Nyb2xsTWFnaWMuQ29udHJvbGxlciwgbGlrZSB2ZXJ0aWNhbCwgZXRjLlxuICAgKiBAdHlwZSBvYmplY3RcbiAgICogQGV4YW1wbGVcbiAgICogY29udHJvbGxlcjogeyB2ZXJ0aWNhbDogZmFsc2UgfVxuICAgKi9cbiAgY29udHJvbGxlcj86IG9iamVjdFxuXG4gIC8qKlxuICAgKiBkdXJhdGlvblxuICAgKiBAZGVzYyBVc2UgdG8gc2V0IHJlc3BvbnNpdmVuZXNzIG9mIHRoZSBuZXcgU2Nyb2xsTWFnaWMuU2NlbmUsIG1vYmlsZS1maXJzdCAoaWYgc2V0dGluZyBicmVha3BvaW50cylcbiAgICogTXVzdCBiZSBzdHJpbmcgZm9yIHBlcmNlbnRhZ2UsIGFuZCBudW1iZXIgZm9yIHBpeGVsLlxuICAgKiBAdHlwZSBvYmplY3RcbiAgICogQGV4YW1wbGVcbiAgICogZHVyYXRpb246ICcxMDAlJyA9IDEwMHZoXG4gICAqIGR1cmF0aW9uOiAxMDAgPSAxMDBweFxuICAgKiBkdXJhdGlvbjogeyAwOiAnNTAlJywgNzY4OiAnMTAwJSB9IC8vID0gU2Nyb2xsU2NlbmUgbGFzdHMgNTB2aCBvbiBtb2JpbGUsIDEwMCUgYWZ0ZXJcbiAgICovXG4gIGR1cmF0aW9uPzogc3RyaW5nIHwgbnVtYmVyIHwgb2JqZWN0XG5cbiAgLyoqXG4gICAqIGdzYXBcbiAgICogQGRlc2MgVXNlIHRvIHNldCBvcHRpb25zIGZvciB0aGUgZ3NhcCBhbmltYXRpb24gb2YgdGhlIFNjcm9sbE9ic2VydmVyLlxuICAgKiBAdHlwZSBvYmplY3RcbiAgICogQGV4YW1wbGVcbiAgICogZ3NhcDogeyB0aW1lbGluZTogbXlUaW1lbGluZSwgeW95bzogdHJ1ZSwgcmV2ZXJzZVNwZWVkOiAyIH1cbiAgICovXG4gIGdzYXA/OiBJU2Nyb2xsT2JzZXJ2ZXJHc2FwXG5cbiAgLyoqXG4gICAqIHRyaWdnZXJIb29rXG4gICAqIEBkZXNjIFNldCB0aGUgb2Zmc2V0IG9mIHRoZSBTY3JvbGxNYWdpYyBzY2VuZS5cbiAgICogQHR5cGUgIG51bWJlciB8IHN0cmluZ1xuICAgKiBAZGVmYXVsdHZhbHVlIDBcbiAgICogQGV4YW1wbGVcbiAgICogb2Zmc2V0OiAxMDBcbiAgICogb2Zmc2V0OiAnMTAlJ1xuICAgKi9cbiAgb2Zmc2V0PzogbnVtYmVyIHwgc3RyaW5nXG5cbiAgLyoqXG4gICAqIHNjZW5lXG4gICAqIEBkZXNjIEV4dHJhIG9wdGlvbnMgdG8gcGFzcyB0aGUgbmV3IFNjcm9sbE1hZ2ljLlNjZW5lLCBsaWtlIGxvZ0xldmVsLCBldGMuXG4gICAqIEB0eXBlIG9iamVjdFxuICAgKiBAZXhhbXBsZVxuICAgKiBzY2VuZTogeyBsb2dMZXZlbDogMiB9XG4gICAqL1xuICBzY2VuZT86IG9iamVjdFxuXG4gIC8qKlxuICAgKiB0b2dnbGVcbiAgICogQGRlc2MgVXNlIHRvIHNldCB0aGUgb3B0aW9ucyBmb3IgdGhlIHRvZ2dsaW5nIG9mIGEgY2xhc3NOYW1lXG4gICAqIEB0eXBlIG9iamVjdFxuICAgKiBAZXhhbXBsZVxuICAgKiB0b2dnbGU6IHsgZWxlbWVudDogY29udGFpbmVyUmVmLmN1cnJlbnQsIGNsYXNzTmFtZTogJ2xldHMtZG8tdGhpcycgfVxuICAgKi9cbiAgdG9nZ2xlPzogSVNjcm9sbFNjZW5lVG9nZ2xlXG5cbiAgLyoqXG4gICAqIHRyaWdnZXJFbGVtZW50XG4gICAqIEBkZXNjIFNldCB0aGUgZWxlbWVudCB5b3Ugd2lzaCB0byB0cmlnZ2VyIGV2ZW50cyBiYXNlZCB1cG9uLCB0aGUgb2JzZXJ2ZWQgZWxlbWVudC5cbiAgICogQHR5cGUgIEhUTUxFbGVtZW50IHwgYW55XG4gICAqIEBleGFtcGxlXG4gICAqIHRyaWdnZXJFbGVtZW50OiB0cmlnZ2VyUmVmLmN1cnJlbnRcbiAgICovXG4gIHRyaWdnZXJFbGVtZW50OiBIVE1MRWxlbWVudCB8IGFueVxuXG4gIC8qKlxuICAgKiB0cmlnZ2VySG9va1xuICAgKiBAZGVzYyBTZXQgdGhlIHRyaWdnZXJIb29rIG9mIHRoZSBTY3JvbGxNYWdpYyBzY2VuZS5cbiAgICogQHR5cGUgIG51bWJlclxuICAgKiBAZGVmYXVsdHZhbHVlICdvbkVudGVyJ1xuICAgKiBAZXhhbXBsZVxuICAgKiB0cmlnZ2VySG9vazogMC41XG4gICAqL1xuICB0cmlnZ2VySG9vaz86IG51bWJlciB8IHN0cmluZ1xuXG4gIC8qKlxuICAgKiB1c2VHbG9iYWxDb250cm9sbGVyXG4gICAqIEBkZXNjIENob3NlIHdoZXRoZXIgb3Igbm90IHRvIHVzZSB0aGUgZ2xvYmFsQ29udHJvbGxlciBwcm92aWRlZCBmb3IgeW91LCBvciBhIGZyZXNoIG5ldyBTY3JvbGxNYWdpYy5Db250cm9sbGVyIGluc3RhbmNlLlxuICAgKiBAdHlwZSBib29sZWFuXG4gICAqIEBkZWZhdWx0VmFsdWUgdHJ1ZVxuICAgKiBAZXhhbXBsZVxuICAgKiB1c2VHbG9iYWxDb250cm9sbGVyOiBmYWxzZVxuICAgKi9cbiAgdXNlR2xvYmFsQ29udHJvbGxlcj86IGJvb2xlYW5cbn1cblxuLy8gYWRkIGNvbnRyb2xsZXIgdmFyXG5sZXQgZ2xvYmFsQ29udHJvbGxlclxuXG5jb25zdCBTY3JvbGxTY2VuZSA9IGZ1bmN0aW9uKFxuICB0aGlzOiBhbnksXG4gIHtcbiAgICBicmVha3BvaW50cyxcbiAgICBjb250cm9sbGVyID0ge30sXG4gICAgZHVyYXRpb24sXG4gICAgZ3NhcCxcbiAgICBvZmZzZXQgPSAwLFxuICAgIHNjZW5lID0ge30sXG4gICAgdG9nZ2xlLFxuICAgIHRyaWdnZXJFbGVtZW50LFxuICAgIHRyaWdnZXJIb29rID0gJ29uRW50ZXInLFxuICAgIHVzZUdsb2JhbENvbnRyb2xsZXIgPSB0cnVlLFxuICB9OiBJU2Nyb2xsU2NlbmUsXG4pIHtcbiAgbGV0IGxvY2FsQ29udHJvbGxlclxuXG4gIC8vIGNoZWNrIGlmIHVzaW5nIGEgbG9jYWwgY29udHJvbGxlclxuICBpZiAoIXVzZUdsb2JhbENvbnRyb2xsZXIpIHtcbiAgICBsb2NhbENvbnRyb2xsZXIgPSBuZXcgU2Nyb2xsTWFnaWMuQ29udHJvbGxlcihjb250cm9sbGVyKVxuICB9XG5cbiAgLy8gbW91bnQgY29udHJvbGxlclxuICBpZiAoIWdsb2JhbENvbnRyb2xsZXIgJiYgdXNlR2xvYmFsQ29udHJvbGxlcikge1xuICAgIGdsb2JhbENvbnRyb2xsZXIgPSBuZXcgU2Nyb2xsTWFnaWMuQ29udHJvbGxlcihjb250cm9sbGVyKVxuICB9XG5cbiAgY29uc3QgY29udHJvbGxlcklzVXNlID0gbG9jYWxDb250cm9sbGVyID8gbG9jYWxDb250cm9sbGVyIDogZ2xvYmFsQ29udHJvbGxlclxuXG4gIGlmICghdHJpZ2dlckVsZW1lbnQpIHtcbiAgICBlcnJvckxvZyhcbiAgICAgIG5hbWVTcGFjZSxcbiAgICAgIGBCZSBzdXJlIHRvIHNldCBhIGNvbnN0IHRyaWdnZXJFbGVtZW50ID0gKHJlYWN0UmVmLmN1cnJlbnQgb3IgZG9jdW1lbnQucXVlcnlTZWxlY3RvcikgaW4gdGhlIG5ldyAke25hbWVTcGFjZX0oeyB0cmlnZ2VyRWxlbWVudDogdHJpZ2dlckVsZW1lbnQgfSlgLFxuICAgIClcbiAgfVxuXG4gIGNvbnN0IFNjZW5lID0gbmV3IFNjcm9sbE1hZ2ljLlNjZW5lKHtcbiAgICB0cmlnZ2VyRWxlbWVudCxcbiAgICB0cmlnZ2VySG9vayxcbiAgICBvZmZzZXQsXG4gICAgLi4uc2NlbmUsXG4gIH0pXG5cbiAgaWYgKGR1cmF0aW9uKSB7XG4gICAgc2V0RHVyYXRpb24oU2NlbmUsIGR1cmF0aW9uKVxuICB9XG5cbiAgaWYgKHRvZ2dsZSAmJiBpc09iamVjdCh0b2dnbGUpKSB7XG4gICAgc2V0Q2xhc3NOYW1lKFNjZW5lLCB0b2dnbGUsIGR1cmF0aW9uKVxuICB9XG5cbiAgaWYgKGdzYXAgJiYgaXNPYmplY3QoZ3NhcCkpIHtcbiAgICBzZXRUd2VlbihTY2VuZSwgZ3NhcClcbiAgfVxuXG4gIHRoaXMuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgIGNvbnRyb2xsZXJJc1VzZSAmJiBTY2VuZS5hZGRUbyhjb250cm9sbGVySXNVc2UpXG4gIH1cblxuICB0aGlzLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHtcbiAgICBTY2VuZS5yZW1vdmUoKVxuICB9XG5cbiAgdGhpcy5TY2VuZSA9IFNjZW5lXG4gIHRoaXMuQ29udHJvbGxlciA9IGNvbnRyb2xsZXJJc1VzZVxuXG4gIHNjcm9sbEFuaW1hdGlvbkluaXQoYnJlYWtwb2ludHMsIHRoaXMuaW5pdCwgdGhpcy5kZXN0cm95KVxufVxuXG5leHBvcnQgeyBTY3JvbGxTY2VuZSB9XG4iXX0=